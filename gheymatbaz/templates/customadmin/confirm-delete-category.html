{% extends 'base.html' %}

{% block content %}
    <!--START-MAIN-->
    <main class="custom-admin-main">
        <div class="cat-block">

            <form method="post">{% csrf_token %}
                <p>Are you sure you want to delete "{{ object }}"?</p>
                <input type="submit" value="Confirm">
            </form>

        </div>
        <div class="cat-block">
            {% for category in categories %}
                {% if not category.parent %}
                    <div class="category-table">
                        <div class="category-table-row">
                            <p class="category-table-colm">
                                {{ category.id }}
                            </p>
                            <p class="category-table-colm">
                                {{ category.name }}
                            </p>
                            <p class="category-table-colm">
                                <span onclick="showSubCat(this , {{ category.id }})">more</span>
                            </p>
                            <p class="category-table-colm">
                                <a href="{% url 'category-update' category.pk %}">ویرایش</a>
                            </p>

                            <p class="category-table-colm">
                                <a href="{% url 'category-delete' category.pk %}">حذف</a>
                            </p>
                        </div>

                    </div>
                {% endif %}



            {% endfor %}


        </div>


    </main>
    <!--END-MAIN-->
{% endblock %}

{% block title %}
    test heed
{% endblock %}


{% block customjs %}
    <script>
        var jsonCategory = {{ json_categories|safe }};
        console.log(jsonCategory)

        function showSubCat(element, cat_id) {

            if (jQuery('#sub-' + cat_id).length === 1) {
                jQuery('#sub-' + cat_id + ':visible').slideUp()
                jQuery('#sub-' + cat_id + ':visible .sub-category-table-row').slideUp()
                jQuery('#sub-' + cat_id + ':hidden').slideDown()
            } else {
                subCategroHTMLMaker = '<div class="sub-category-table-row" id="sub-' + cat_id + '">'
                for (var category in jsonCategory) {
                    if (jsonCategory[category]['fields']['parent'] === cat_id) {
                        subCategroHTMLMaker += '<div class="category-table"><div class="category-table-row"><p class="category-table-colm">'
                        subCategroHTMLMaker += jsonCategory[category]['pk']
                        subCategroHTMLMaker += '</p><p class="category-table-colm">'
                        subCategroHTMLMaker += jsonCategory[category]['fields']['name']
                        subCategroHTMLMaker += '</p><p class="category-table-colm"> <span href="" onclick="showSubCat(this ,'
                        subCategroHTMLMaker += jsonCategory[category]['pk']
                        subCategroHTMLMaker += ' )">more</span> </p>'
                        subCategroHTMLMaker += ''
                        subCategroHTMLMaker += '<p class="category-table-colm">' +
                            '<a href="/dj-admin/category/' + jsonCategory[category]['pk'] + '">' +
                            'ویرایش' +
                            '</a>' +
                            '</p>'


                        subCategroHTMLMaker += '<p class="category-table-colm">' +
                            '<a href="/dj-admin/category/' + jsonCategory[category]['pk'] + '/delete">' +
                            'حذف' +
                            '</a>' +
                            '</p>'
                        subCategroHTMLMaker += '</div></div>'

                    }
                }
                subCategroHTMLMaker += '</div>'
                jQuery(element).parent().parent().parent().append(subCategroHTMLMaker)
            }

        }

    </script>
{% endblock %}

{% block customstyle %}
    <style>
        .category-table-row {

            margin-bottom: 0;
            padding: 0px 15px;
            border-bottom: 1px solid #eee;
        }

        .sub-category-table-row {
            margin-right: 25px;
        }

        .category-table-colm {
            display: inline-block;
            margin-bottom: 0;
            padding: 8px 15px;
        }

        .custom-admin-main {
            padding: 20px;
        }

        .cat-block {
            display: inline-block;
            width: 45%;
            vertical-align: top;
        }
    </style>
{% endblock %}